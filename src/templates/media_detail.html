{% extends "base.html" %}

{% block title %}{{ media.title }} - MeaningDB{% endblock %}
{% block body_class %}media-detail-page{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/media_detail.css') }}">
{% endblock %}

{% block content %}
<div class="media-detail-container">
    <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ–¥–∏–∞ -->
    <aside class="media-info">
        <img src="{{ media.poster_url }}" alt="{{ media.title }}" class="media-poster" onerror="this.src='https://via.placeholder.com/300x450/6e8efb/ffffff?text=No+Image'">
        
        <h1 class="media-title">{{ media.title }}</h1>
        
        <div class="media-release-date">
            {% if media.release_date %}
                –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞: {{ media.release_date }}
            {% endif %}
            {% if media.type %}
                <br>–¢–∏–ø: {{ media.type }}
            {% endif %}
        </div>

        {% if media.description %}
        <div class="media-description">
            <h3 class="description-title">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p>{{ media.description }}</p>
        </div>
        {% endif %}

        <div class="action-buttons">
            <a href="/media/{{ media.id }}/edit" class="btn btn-edit">
                <span>‚úèÔ∏è</span>
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
            <a href="/media/{{ media.id }}/delete" class="btn btn-delete" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ–¥–∏–∞?')">
                <span>üóëÔ∏è</span>
                –£–¥–∞–ª–∏—Ç—å
            </a>
        </div>

        {% if media.platforms %}
        <div class="media-platforms">
            <h3 class="platforms-title">–ì–¥–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</h3>
            <ul class="platforms-list">
                {% for platform in media.platforms %}
                <li class="platform-item">
                    <a href="{{ platform.url }}" target="_blank" class="platform-link">
                        <span class="platform-icon">üõí</span>
                        {{ platform.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </aside>

    <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ç–µ–º—ã –∏ –≤–æ–ø—Ä–æ—Å—ã -->
    <main class="themes-section">
        <a href="javascript:history.back()" class="back-link">
            <span class="back-icon">‚Üê</span>
            –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
        </a>

        <h2 class="themes-title">–ü–æ–¥–Ω–∏–º–∞–µ–º—ã–µ —Ç–µ–º—ã –∏ –≤–æ–ø—Ä–æ—Å—ã</h2>
        
        <ul class="accordion">
            {% for theme in media.themes %}
            <li class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <h3 class="accordion-title"><a href="/theme/{{ theme.id }}" class="result-title">{{theme.title}}</a></h3>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    <p class="theme-description">{{ theme.description }}</p>
                    
                    {% if theme.examples %}
                    <div class="theme-examples">
                        <h4>–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:</h4>
                        {% for example in theme.examples %}
                        <p class="theme-example">{{ example }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% if theme.related_themes %}
                    <div class="related-themes">
                        <h4>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã:</h4>
                        <p>{{ theme.related_themes|join(', ') }}</p>
                    </div>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleAccordion(header) {
    const content = header.nextElementSibling;
    const icon = header.querySelector('.accordion-icon');
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã
    document.querySelectorAll('.accordion-content.active').forEach(item => {
        if (item !== content) {
            item.classList.remove('active');
            item.previousElementSibling.querySelector('.accordion-icon').classList.remove('rotated');
        }
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫–∫–æ—Ä–¥–µ–æ–Ω
    content.classList.toggle('active');
    icon.classList.toggle('rotated');
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –∞–∫–∫–æ—Ä–¥–µ–æ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const firstAccordion = document.querySelector('.accordion-header');
    if (firstAccordion) {
        firstAccordion.click();
    }
});
</script>
{% endblock %}